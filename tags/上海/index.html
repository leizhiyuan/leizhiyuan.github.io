<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>上海 | bystander&#39;s blog</title>
    <meta property="og:title" content="上海 - bystander&#39;s blog">
    <meta property="og:type" content="article">
        
        
    <meta name="Keywords" content="">
    <meta name="description" content="上海">
        
    <meta name="author" content="bystander">
    <meta property="og:url" content="http://leaver.me/tags/%E4%B8%8A%E6%B5%B7/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <link rel="alternate" type="application/rss+xml+xml" href="http://leaver.me/tags/%E4%B8%8A%E6%B5%B7/index.xml" title="bystander's blog" />
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    


    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://leaver.me/">
                        bystander&#39;s blog
                    </a>
                
                <p class="description">寻找窄门</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="http://leaver.me/">首页</a>
                    
                    <a  href="http://leaver.me/categories" title="目录">目录</a>
                    
                    <a  href="http://leaver.me/about/" title="关于我">关于我</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <h3 class="archive-title">
        包含标签
        <span class="keyword">上海</span>
        的文章
    </h3>
    

    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2014/03/11/%E8%97%8F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">[藏]深入理解Java内存模型</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2014年3月11日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F'>文章收藏</a>
            
        </div>
        
        <div class="post-content">
             深入理解java内存模型（一）——基础 深入理解java内存模型（二）——重排序 深入理解java内存模型（三）——顺序一致性 深入理解java内存模型（四）——volatile 深入理解java内存模型（五）——锁 深入理解java内存模型（六）——final 深入理解java内存模型（七）——总结  ……
            <p class="readmore"><a href="http://leaver.me/2014/03/11/%E8%97%8F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">阅读全文</a></p>
        </div>
    </article>
    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2014/03/08/linux%E7%9A%84cpu%E8%B4%9F%E8%BD%BD%E5%9D%87%E5%80%BC/">linux的CPU负载均值</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2014年3月8日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0'>学习笔记</a>
            
        </div>
        
        <div class="post-content">
            当运行在Linux上的程序有问题之后，我们通常要看一下当前CPU和内存的使用情况来分析一下问题
对于CPU的使用率，通常用Load Average，也就是负载均值来度量
负载均值是啥？
负载是啥，负载就是对CPU使用率的一个计量，均值就是某一段时间内的一个平均值。
怎么看啊？
直接输入w命令
第一位1.20：表示最近1分钟平均负载 第二位1.28：表示最近5分钟平均负载 第三位1.29：表示最近15分钟平均负载
或者uptime命令
我们一般认为0.00表示无负载，可以理解为CPU空闲，1.00表示CPU满负载，但是注意，1.00是对于单cpu来说的，也就是说，如果是双核，那么这个满负载显示的值应该是2.00，以此类推。
怎么看我是几核啊
通过统计cpuinfo的model name信息来算的
这三个值哪个重要？
一分钟内突然负载很大没关系，当然如果你要排查也没人拦着，如果15分钟的负载均值超过cpu的数目，就要关注了。
那什么就是理想负载呢？
以单个cpu为例，1.00表示cpu满负载运行，没有一点点浪费，实际上，有些管理员认为0.7也许是理想的状态。如果你的经常超过0.7，那么最好查一查。……
            <p class="readmore"><a href="http://leaver.me/2014/03/08/linux%E7%9A%84cpu%E8%B4%9F%E8%BD%BD%E5%9D%87%E5%80%BC/">阅读全文</a></p>
        </div>
    </article>
    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2014/03/08/eclipse%E7%AE%A1%E7%90%86%E5%A4%9A%E4%B8%AAworkplace/">eclipse管理多个workplace</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2014年3月8日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0'>学习笔记</a>
            
        </div>
        
        <div class="post-content">
            由于eclipse用的比较多，管理多个workplace很麻烦，经常需要打开以后再切换，简单介绍个方法。
一
1.进入Eclipse的安装目录，鼠标点击eclipse.exe，右键菜单&ndash;&gt;发送到&ndash;&gt;桌面快捷方式
2.到桌面上找到“eclipse.exe - 快捷方式”，鼠标右键点击查看属性，弹出菜单中选择“快捷方式”标签，然后在“目标”中增加内容：-data e:\workspace，保存后即可
3.双击这个快捷方式，eclipse就会使用e:\workspace作为工作空间启动。
这样你多复制几个，就好了。
二
1.找个目录，新建一个文件夹，名称为workspace_aaa
2.然后在当前目录下新建一个txt文件
3.输入内容为：
说明：前面是eclipse的路径，中间加上&rdquo;-data” ，后面为工作空间的路径，start要有，不然打开eclipse之后，命令行窗口不会自动消失的，很是碍眼。
4.将这个txt保存为workspace1.bat
5.双击这个workspace1.bat，eclipse就会使用workspace1.bat 作为工作空间启动。
 对launchy党来说，新建个目录，然后创建好多个bat，以后直接快速启动真是太方便了……
            <p class="readmore"><a href="http://leaver.me/2014/03/08/eclipse%E7%AE%A1%E7%90%86%E5%A4%9A%E4%B8%AAworkplace/">阅读全文</a></p>
        </div>
    </article>
    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2014/02/11/%E5%B0%9D%E8%AF%95javafx%E5%BC%80%E5%8F%91/">尝试JavaFX开发</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2014年2月11日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0'>学习笔记</a>
            
        </div>
        
        <div class="post-content">
            曾经有报道说JavaFX将使java在桌面开发上大有作为，感觉好像是很高端的样子，今天尝试了一下，界面对于自用的工具来说，本来也不多重要，只是一个简单的尝试
简单说下大致的步骤和一些思路，可能有错误。
javafx需要sdk支持，java7之后的都有的。设计思路是数据和代码分离，界面通过xml或json数据来描述，这样就把业务逻辑代码和界面实现代码分开了
一个简单的开发过程应该是这样的
1.使用JavaFX Scene Builder来绘制界面，保存为xml/json格式
画的话没啥要说的，了解一下基本的整体概念就行。
2.在eclipse里新建工程，可以是普通工程，将1中的文件放到资源目录，在代码里加载，然后界面就加载成功了。
逻辑代码，比如一个简单的按钮事件可以通过
来查找到id为paneRightBottom的元素，然后就可以通过对node添加事件监听器来完成一些功能了
主要想说的是：
JavaFX和WPF其实思路是一模一样的，恰好WPF我也用过，感觉两个都没搞起来，虽然界面炫，然后我去维基看了下：
 该产品于2007年5月在JavaOne大会上首次对外公布。JavaFX技术主要应用于创建Rich Internet application（RIAs）。JavaFX期望能够在桌面应用的开发领域与Adobe公司的AIR、OpenLaszlo以及微软公司的Silverlight相竞争 已经7年了，用户数应该是非常少的，成熟的商业型产品也没几个，在尝试的过程中，我在stackoverflow，以及一些很不错的java博客上，大量查找基本也没有太多的信息，都是一些很浅的应用，包括stackoverflow上的回答数，基本还是能反映出来的，主要应用于RIA，而当前RIA已经出html5的天下了。SL早都不更新了，这种坑爹的所谓新技术。
  Oracle还是好好把Swing搞好吧。。不建议尝试。
 ……
            <p class="readmore"><a href="http://leaver.me/2014/02/11/%E5%B0%9D%E8%AF%95javafx%E5%BC%80%E5%8F%91/">阅读全文</a></p>
        </div>
    </article>
    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2014/02/09/%E8%97%8F%E9%9A%90%E8%97%8F%E5%9C%A8png%E5%9B%BE%E5%83%8F%E5%85%83%E6%95%B0%E6%8D%AE%E4%B8%AD%E7%9A%84%E6%96%B0iframe%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/">[藏]隐藏在PNG图像元数据中的新iFrame注入攻击</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2014年2月9日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F'>文章收藏</a>
            
        </div>
        
        <div class="post-content">
            这个攻击方式很旧了，但手法相当不错，来自乐嵌网
我们一直在努力保持领先的最新趋势，今天我们发现了一个非常有趣的事，这或者是我们之前没有发现，或者是刚发生的。 我们只能说这是新发现的。
 我们都了解的iFrame注入攻击，对吧？
 了解一个iFrame注入
今天的iFrame 是非常标准的HTML标记，它是在自己网页中嵌入其他网站内容的简单方式。 被几乎所有的浏览器支持和百万计的网站使用，使用AdSense吗？ 那么你的网站中就有一个iFrame。
我知道这东西很好，然而总是福祸相惜。
今天的攻击，特别是当我们谈论路过式下载，首选是利用IFRAME标记。 它简单方便，只需简单的属性修改，攻击者可以稳妥的从另一个站点嵌入代码，并通过客户的浏览器不知不觉的加载。
 像这样：

 攻击者通常从其他网站嵌入的恶意文件，通常是一个PHP文件或类似的形式。 当然，这并不是唯一的方法，但是是最普遍的。 从检测和修复的角度来看，这往往很容易修复。
 新的iFrame注入法
然而今天，我们发现一个有趣的iFrame注入类型。
它的特殊之处不是在iframe标签中嵌入的内容，而是它分发恶意软件的方式。 你会看到，攻击者将威胁隐藏在PNG文件中。
我几乎可以听到很多你的窃笑，PFF .. 这不是新的…. 但问题是在细节上我的朋友。
 如下，iFrame加载了一个有效的文件，没有什么恶意，一个叫jquery.js的JavaScript文件。这一切看上去都很好。你要细细的找：

起初，很多人会说我们傻。 这些代码很好，没看见什么问题，对不对？ 然后，我们注意到了这个小函数，loadFile（）。 函数本身并不奇怪，但事实上，它是装载一个PNG-var strFile = ‘./dron.png。 你会被它惊讶良久，它才是一个真正的黑手。
 自然，下一步就是好奇的打开dron.png文件。 会有什么可怕的事情发生吗？
 噢，什么都没有，太无聊了，这纯粹是浪费时间。

但是，请等一下，我发现这里有个有趣的小循环。

嗯，这是确实挺奇怪的，这是一个解码循环。 为什么要一个循环的解码PNG文件呢？
 作为一个优秀的研究人员，采取最简单的方式，我可以将它加载到简单的测试页上 并提取图像内容。搞定！
 测试页上加载它之后这，我们获得了strData变量：

 看到它在干嘛了吗？
它做了个iFrame注入，并把它嵌入到PNG的元数据中，像一个新的分配机制。
 有两点需要特别注意了，它使用createElement做了一个iFrame标签**，**然后设置**elm.style.position.left 和 elm.style.position.top **属性的值为-1000px，把iframe放到可视区域之外。这些值都是负值，在浏览器中根本看不到。但是你知道谁能看到吗？只有浏览器和Google能看到。这就是下载驱动和搜索引擎感染（SEP)攻击的小伎俩。
 最后我们在elm.src元素中发现了真正的威胁**。**
 做的这么独特到底有什么用呢？
它尽力隐藏真正的威胁的水平是独特的。现在的杀毒软件不会解码图像元数据，直到JavaScript文件加载完毕就停止扫描。不会追踪cookie文件，对于攻击者来说，这太好了，使它们很难被发现。
 记住一点，尽管我们这里谈论的是PNG文件，这些方法和概念也可以应用到其他类型图像中。重要的一点是：留意你的web 服务状态，了解哪些修改和未修改的文件并确保漏洞未被利用。
 通常情况下，一些新的侦查和排障需要一定的时间。 现在我们的 网站恶意软件扫描器能发现它吗 ？ 绝对可以！
 不要笑了，朋友们！
原文：new-iframe-injections-leverage-png-image-metadata by Peter Gramantik……
            <p class="readmore"><a href="http://leaver.me/2014/02/09/%E8%97%8F%E9%9A%90%E8%97%8F%E5%9C%A8png%E5%9B%BE%E5%83%8F%E5%85%83%E6%95%B0%E6%8D%AE%E4%B8%AD%E7%9A%84%E6%96%B0iframe%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/">阅读全文</a></p>
        </div>
    </article>
    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2014/02/08/%E7%AC%94%E8%AE%B0%E5%86%99%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB%E4%B8%8B/">[笔记]写代码遇到的一些问题汇总下</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2014年2月8日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0'>学习笔记</a>
            
        </div>
        
        <div class="post-content">
            本篇是用来填上一篇 挖下的坑的。
1.java调用webservice
有一些已有的webservice服务，由xfire生成发布，有些有参数，有些无参数，无参数的直接我直接使用org.codehaus.xfire这个包里的Client来动态生成客户端。然后调用就可以了。非常简单
但对于有参的，且是服务器自定义的类作为参数的时候，实在是搞不定。。不管是把自定义的类放到本地，包名一致，在invoke的时候生成这个对象还是其他什么方法。都无法完成。
最终换了直接发送soap报文来完成。dirty hack啊。如果你有一些好的方法希望不吝赐教。
解决方案来源自stackoverflow，因为stackoverflow现在国内好像有时候打不开。因此把代码贴过来。有疑问的话留言讨论。
2.Access restriction on class due to restriction on required library rt.jar? 报错
总么都感觉是环境问题，系统bug。解决如下：
 进入project properties的 Build Path 设置里. 移除 JRE System Library 再添加回来，方法是: 选择 &ldquo;Add Library&rdquo; ，然后选择 JRE System Library.   3.SSHManager类报错：com.jcraft.jsch.JSchException: UnknownHostKey
我使用的一个SSHManager类如下：
报这个错是因为
连接这段代码里少了config.put(&ldquo;StrictHostKeyChecking&rdquo;, &ldquo;no&rdquo;);这段设置，这个是去掉了严格的安全检查，一般只用于测试目的。
4.navicat连接oracle数据库
之前使用PL/SQL操作Oracle数据库，使用Heidisql操作mysql数据库。。切换麻烦。而且PL/SQL搜索的时候中文有问题。于是打算使用navicat统一管理
方法是：
1.首先下载Instant Client 的32位版本和Navicat Premium
2.然后解压Instant Client，配置navicat

选择oci文件即可
然后新建oracle配置，选择basic模式，其他的根据你的数据库信息自己填写即可。
 5.HttpClient的logger日志实在太多了
大人，实在太多了。看不过来啊。附赠一篇log4j配置文件详解
在log4j.properties文件中添加如下配置信息
log4j.logger.httpclient.wire.header=INFO
log4j.logger.httpclient.wire.content=INFO
log4j.logger.org.apache.commons.httpclient = INFO
最后附赠一些实用的工具
http://www.freeformatter.com/ 程序员必备。各类转换，包括转义工具，格式校验工具。效果很好。
流体力学理论与F1赛车的空气动力学1，2，3 什么雷诺数，伯努利方程，文丘里效应，当年木有好好学啊。这么高大上的东西果然还是有压力。……
            <p class="readmore"><a href="http://leaver.me/2014/02/08/%E7%AC%94%E8%AE%B0%E5%86%99%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB%E4%B8%8B/">阅读全文</a></p>
        </div>
    </article>
    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2014/02/04/%E7%AC%94%E8%AE%B0%E5%86%99%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB%E4%B8%8A/">[笔记]写代码遇到的一些问题汇总上</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2014年2月4日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0'>学习笔记</a>
            
        </div>
        
        <div class="post-content">
            今天大雪，天冷，不能出去玩了。把保存在pocket里的一些记录总结一下，太懒了。。下篇等我去了上海用我电脑写吧
1.java模拟https登陆
首先我要登陆，然后保存cookie，然后利用cookie来访问后续的网页，发包，处理包这样，然后，为了方便，我选择了 org.apache.http 这个库，典型的一个登陆场景应该是这样的，以后遇到问题一定先要去看官方的例子，别人给出的例子一般要么是不能用，要么是用的方法都是一些过时的，虽然能用，但看到警告还是不舒服。
但是，这个过程报了如下的错
google之，发现时访问https的原因。需要先安装对应站点的证书。这里要用到一个通用的java类，我贴下链接
编译这个工具类，然后执行java InstallCert &lt;host&gt;[:port] 会生成一个证书文件
然后在项目里通过
设置即可，你可以吧证书文件放到资源目录，就更好了。
2.java正则替换反斜线
我在某个地方需要把字符串里的所有反斜线替换成两个，我就写了
结果发现我还是too young,实际上，
java replaceAll() 方法要用 4 个反斜杠,表示一个反斜杠 例如
要想替换成
必须这样替换：
原因如下： String 的 replaceAll（） 方法，实际是采用正则表达式的规则去匹配的， \\ ，java解析为\交给正则表达式， 正则表达式再经过一次转换，把\转换成为\ 也就是java里面要用正则来表示一个. 必须写成4个\ 如果要表示\，那就要写8个\ 所以如果写成： str1 = str1.replaceAll(&quot;\&quot;, &ldquo;\\&quot;); 就会报正则表达式的错误。
3.httpClient如何模拟表单上传文件
这个还是要去看官方例子，网上没找到，需要添加
org.apache.http.entity包
其他都和普通的post请求没啥区别了
4.json-lib的一个问题
在maven里添加了json-lib的依赖后，启动报错
missing net.sf.json-lib，但实际上这个我的确是加载进来了。去了SO，才知道，还需要知道classifier 依赖，把jdk的版本添加上就行。这个应该是我当时添加的时候没有去maven中央库填写造成的
然后在工程目录执行
就会在target目录生成jar包啦……
            <p class="readmore"><a href="http://leaver.me/2014/02/04/%E7%AC%94%E8%AE%B0%E5%86%99%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB%E4%B8%8A/">阅读全文</a></p>
        </div>
    </article>
    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2014/01/28/%E5%89%8D%E8%B7%AF%E6%9C%88%E5%85%89/">前路月光</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2014年1月28日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E6%88%91%E7%9A%84%E7%BF%BB%E8%AF%91'>我的翻译</a>
            
        </div>
        
        <div class="post-content">
            火影片头曲想知道中文，没找到翻译，于是译之，感谢@sepith  。
今夜月光 不知为何 比往日温柔 崎岖泥泞的来时路 何时才能有同行之人
我沉默 为即将而来的眼泪 泪水中努力 悲伤着变得更强
很多时候，伤痕累累 忘掉了痛苦 流过血泪 王者归来是使命所及 哪管一路秋叶萧萧
我仰望星空 孤独从来不是虚假的幻想 你的过去我无法参与 我想要的的是现在和未来
昨日月光 无论是明亮，还是黯淡 我用双手铸造 始于生而终于死 一定错过了 诸多美好
我的同伴 虽然时过境迁 可是，你住过的地方 经年难忘 如果你想对我说 我还是会在你身边 舍命相陪
很多时候，伤痕累累 星空暗淡 假使黎明 也悄然消失 我一定再一次 为了梦想努力拼搏
痛到难以承受 迷惘前路崎岖 我轻轻闭上双眼 感受月光温柔 前路相伴 岂敢轻易迷失
如果欺骗了内心 失去了自己 莫忘星空璀璨 凝视遥远的未来 固执地努力
很多时候，伤痕累累 忘掉了痛苦 流过血泪， 王者归来是使命所及 哪管一路秋叶萧萧
我仰望星空 真正强大的是 心怀梦想的人 有着爱的人……
            <p class="readmore"><a href="http://leaver.me/2014/01/28/%E5%89%8D%E8%B7%AF%E6%9C%88%E5%85%89/">阅读全文</a></p>
        </div>
    </article>
    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2013/12/14/%E8%97%8F%E8%B7%A8%E8%A1%8C%E6%B8%85%E7%AE%97%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">[藏]跨行清算系统的实现原理</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2013年12月14日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F'>文章收藏</a>
            
        </div>
        
        <div class="post-content">
            本文来自God Is Coder，通过这篇文章我算是理解了跨行清算系统逻辑，非常非常好。
最近看了很多银联方面的清算系统的设计原理，对于跨行清算系统有了很大的了解，写这篇文章的目的是在于从一个程序员的角度去思考一个跨行清算系统的架构是如何实现的以及整个过程中我们有哪些思想是可以借鉴的。由于金融里面涉及到太多的专业名词，包括借贷，备付金，头寸，调拨等等，这里不会涉及到这些，取而代之的是以大家可以理解的概念去解释。
下面简单的介绍一下两种跨行清算系统的实现原理以及特点。一种跨清算系统是我们最熟悉的银联，还有一种是越来越流行的第三方支付系统，比较典型的是快钱。
首先来拿生活中的一个非常常见的例子来说明跨行清算的整个过程，这里面不涉及交易费等其他概念。
跨行取款流程 张三是工行的持卡人，他需要取现金，但是找不到工行的ATM机器，发现附近有建行的ATM机器，他只能去建行取款，整个过程就是跨行清算的过程，我们以这个场景为例，分析一下业务流程，具体交互流程见下面一张图。

 工行持卡人张三在建行ATM机器取款100，ATM请求建行主机，由于是工行的卡，建行不识别，只能请求工行去处理，工行识别持卡人账户并扣款100，然后通知建行，建行则通知atm吐钱。
这里整个系统要解决两个问题：
1 建行如何与工行通信
2 建行和工行之间如何清算，如上图结果，工行欠建行100.
整个系统的分析基于以上两个问题，下面首先解决是通信问题
 跨行通信的两种模式 我们先假设工行提供接口，只需要建行发送指约定格式的报文，即可于工行通信，这种相当于建行直接通过接口方式与工行通信。如果是这种方式，只能解决建行和工行的单向通信，如果工行和建行通信，则工行要发送建行指定的通信报文格式。可是大家想想，如果银行更多怎么办，下面是三家银行间的通信

当有三家银行的时候，通信链路就有3*2=6条，当银行越来越多的时候，这种点对点的通信变的越来越复杂，每新增一家银行，他要做之前银行都要做的很多重复性的劳动，这样的成本非常高，也不经济，那么必须出现一个网络，它能够接入所有的银行，新的银行只需要接入这个网络，就可以和其他所有的银行进行通信。
先把这个网络成为通信网络，这种通信网络有两种方式可以连接所有的银行
 1 这个通信网络定义标准接口，所有的银行都必须实现这个通信网络定义的api，新的银行如果想要接入这个通信网络，必须实现通信接口约定的协议。简称公共接口模式 2 这个通信网络主动去连接所有的银行的接口，把所有银行的接口信息都接入里面，就像一个适配器，新的银行如果想要接入这个通信网络，这个通信网络必须主动联系银行，按照银行的接口协议实现通信，简称适配器模式。 下面一幅图演示了这两种模式的不同：  
对于这两模式，主要博弈就在于谁强谁弱。显然第三方支付公司属于适配器模式，需要一家一家银行去接入，至于银联，个人认为应该是第一种模式，这种对于银联这种需要稳定的系统来说是最具有优势的。
 跨行清算保证金模式 解决了通信问题，下面就看如何解决资金的清算问题。一种简单的方案就是工行在建行里面开设一个保证金账户，用这个账户去偿还在整个跨行交易中应付给建行的资金。

 从上图来看，这种方案确实可行。只需要工行在建行里面放足额的保证金，就可以满足跨行的费用。但是这里面实际上存在非常多的问题，
 1 如果银行越来也多，每个银行都要在其他银行存钱，太不经济了 2 保证金需要放多少资金？如果一直都没有发生跨行交易，工行就亏大发了 3 如果保证金不够怎么办？交易失败还是记应收款？ 对于第一个问题假设银行越来越多，会导致工行需要在其他每个银行里面都开设保证金账户（见下图），是一个很不经济的方案。  说明这个在其他银行存保证金的方案是不可行的，和之前通信的问题一样，是不是可以把所有的银行保证金账户单独管理起来，统一放置在一起，方便各个银行之间的清算。我们暂时把这个系统称之为保证金系统。
保证金系统 保证金就是方便各个银行之间的清算，需要单独由一个系统进行管理，解决了跨行之间保证金存放的问题。每个银行只需要在保证金系统中存点钱就可以了。保证金系统也有两种模式。先看看比较好理解的第一种模式：

在这种模式下，银行先把一部分钱存放在保证金系统里面，同时银行内部建立一个虚拟账户，记录存放了多少钱，主要是方便对账，万一这个保证金系统钱算错了怎么办。你可以想象一下，银行是很小气的，为啥愿意把钱存放到这保证金系统里面，这部分钱干啥不好，能够银行这么干的只有国家了，这个系统就是央行的备付金管理系统。每个新增的银行都要存一份钱在这里。
另外一种方案是倒过来思考，既然没有牛逼的央行作支撑，那可以在每个商业银行都建立一个账户，用这个账户负责和银行进行清算。每新增一家银行，就在那个银行里面开一个保证金账户。

这两种方式有本质的不同，一个是银行把资金的一部分转出到保证金，银行建立虚拟账户和保证金里面真实的资金映射。一个是保证金系统把资金转出到各个银行，自己内部建立一个虚拟账户和银行中真实的资金账户进行映射。这个间接的银行了后续的对账机制，这里先不叙述。
所有的第三方支付公司跨行清算的流程都是第二种方式，只有国家级清算公司（比如银联）是第一种方式，这是一种资源和权力上的不平等，不过是可以理解的。
清算系统 保证金系统解决了保证金存放的问题，接下来就是解决如何清算的问题。假设保证金转账是实时的，就要面对上面说的问题，保证金不够的情况下，跨行交易是成功还是失败。这是一个业务上问题，有很多种解决方案，我们暂不说。从技术上来讲，如果每一笔交易都要保证金实时记账，那么保证金系统的负载太大，事务如何保证等等一些列的问题。所以一个最简单的方案就是：一天结算一次。
每天由一个系统记录这些跨行交易信息，汇总出来，统一记账。这样一天只需要调用一次保证金系统即可。那么整个清算过程则是下面的流程：
  1 系统T日发生建行和工行的跨行交易100 
  2 清算系统T+1日汇总T日工行和建行之间发生的交易明细数据，并且发这些数据发给建行和工行进行确认 
    3 工行建行分别对明细对账确认之后，通知清算系统确认交易明细无误，清算系统开始清算，调用保证金支付系统转账。 4 清算完成之后，工行和建行分别获取保证金系统的真实金额和自身系统内部的映射账户进行余额对账。    清算中心最主要干得事情就是统计谁欠谁多少钱，以及触发保证金系统的调拨操作。
 对账流程 对账包括两个部分，一个是跨行交易明细的对账以及保证金余额的对账。
首先要思考的是：对账是谁发起的 ？ 这个是了解对账的本质。
我们举生活中的一个例子，我们把钱投资到一个人，那个人负责公司的日常运作。你肯定会主动了解公司的账务，因为那个是你的钱。对账的发起人也是如此，对于银联的清算过程，对账的发起者是商业银行，因为你把钱放在保证金系统里面，这是你的钱，你需要去关心这个的，银联可不关心这个。
对于另外一种保证金系统，把钱放在各个银行里面了，那么对账的发起者就是这个保证金系统维护者了。目前普遍的第三方支付公司都是这个模式，所以他要找各个银行要结果明细进行对账，确认自己的资金安全无误。
 以上就是一个简单的跨行清算系统的雏形，从一个就简单的例子入手，说明一个清算过程。目前银联的第三方支付公司的清算过程大致如此，但是实现细节远比这个复杂。但是一个基本的清算系统的本质模型大体上是不会变的。当然这个只是对于同币种的清算，不同币种或者虚拟货币的清算会涉及到汇率的问题，这些就很复杂，有机会在研究一下，后续在分享。
PS：以上很多名词都是自己的随意写的，里面很多专业名词这里不提及，有兴趣的可以自己去了解。……
            <p class="readmore"><a href="http://leaver.me/2013/12/14/%E8%97%8F%E8%B7%A8%E8%A1%8C%E6%B8%85%E7%AE%97%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/">阅读全文</a></p>
        </div>
    </article>
    
    <article class="post">
        <header>
            <h1 class="post-title">
                <a href="http://leaver.me/2013/11/24/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AE%9E%E4%BE%8B/">Java动态代理实例</a>
            </h1>
        </header>
        <date class="post-meta meta-date">
            2013年11月24日
        </date>
        
        <div class="post-meta meta-category">
            |
            
            <a href='http://leaver.me/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0'>学习笔记</a>
            
        </div>
        
        <div class="post-content">
            首先什么是代理？
我更喜欢另一种通俗的解释，官方的解释总是高度抽象的，等用了一段时间才能理解体会
那我们就得定义一个拦截器/执行处理器了。
这客户端咋用啊，老湿
看到没，通过Proxy类的newProxyInstance方法，传入类加载器，类接口，和这个处理器，我们就获得一个代理
执行结果是这样的
恩，电脑没死机，是这样的
 ……
            <p class="readmore"><a href="http://leaver.me/2013/11/24/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AE%9E%E4%BE%8B/">阅读全文</a></p>
        </div>
    </article>
    

    





</div>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='http://leaver.me/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="http://leaver.me/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="http://leaver.me/2019/12/30/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3raft%E5%8D%8F%E8%AE%AE/" title="深入理解Raft协议">深入理解Raft协议</a>
    </li>
    
    <li>
        <a href="http://leaver.me/2019/10/27/%E9%9D%9E%E6%9A%B4%E5%8A%9B%E6%B2%9F%E9%80%9A%E7%AC%94%E8%AE%B0/" title="《非暴力沟通》笔记">《非暴力沟通》笔记</a>
    </li>
    
    <li>
        <a href="http://leaver.me/2019/10/06/wedding-of-friends/" title="Wedding of Friends">Wedding of Friends</a>
    </li>
    
    <li>
        <a href="http://leaver.me/2019/09/29/principle-note/" title="Principle Note">Principle Note</a>
    </li>
    
    <li>
        <a href="http://leaver.me/2019/09/14/%E6%A2%A6%E8%A7%81%E9%B2%B8%E9%B1%BC%E7%9A%84%E9%82%A3%E4%B8%80%E5%A4%9C/" title="梦见鲸鱼的那一夜">梦见鲸鱼的那一夜</a>
    </li>
    
    <li>
        <a href="http://leaver.me/2019/08/20/understand-hong-kong-2/" title="Understand Hong Kong 2">Understand Hong Kong 2</a>
    </li>
    
    <li>
        <a href="http://leaver.me/2019/08/18/understand-hong-kong-part-1/" title="Understand Hong Kong Part 1">Understand Hong Kong Part 1</a>
    </li>
    
    <li>
        <a href="http://leaver.me/2019/07/09/%E9%94%99%E8%BF%87%E7%9A%84%E9%83%BD%E6%98%AF%E5%91%BD%E5%BE%97%E5%88%B0%E7%9A%84%E6%89%8D%E6%98%AF%E4%BA%BA%E7%94%9F/" title="错过的都是命，得到的才是人生">错过的都是命，得到的才是人生</a>
    </li>
    
    <li>
        <a href="http://leaver.me/2019/04/06/recently/" title="Recently">Recently</a>
    </li>
    
    <li>
        <a href="http://leaver.me/2019/03/01/mac%E8%BF%81%E7%A7%BB%E5%AF%BC%E8%87%B4golang%E6%97%A0%E6%B3%95debug%E7%9A%84%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D/" title="Mac迁移导致Golang无法debug的问题修复">Mac迁移导致Golang无法debug的问题修复</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li><a href="http://leaver.me/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记 (186)</a></li>
    
    <li><a href="http://leaver.me/categories/%E6%88%91%E7%9A%84%E7%BF%BB%E8%AF%91/">我的翻译 (57)</a></li>
    
    <li><a href="http://leaver.me/categories/%E6%96%87%E7%AB%A0%E6%94%B6%E8%97%8F/">文章收藏 (53)</a></li>
    
    <li><a href="http://leaver.me/categories/%E7%94%9F%E6%B4%BB%E8%AE%B0%E5%BD%95/">生活记录 (2)</a></li>
    
    <li><a href="http://leaver.me/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记 (4)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="http://leaver.me/tags/android/">android</a>
    
    <a href="http://leaver.me/tags/c/">C＃</a>
    
    <a href="http://leaver.me/tags/c&#43;&#43;/">C&#43;&#43;</a>
    
    <a href="http://leaver.me/tags/java/">java</a>
    
    <a href="http://leaver.me/tags/javascript/">javascript</a>
    
    <a href="http://leaver.me/tags/linux/">linux</a>
    
    <a href="http://leaver.me/tags/mac/">mac</a>
    
    <a href="http://leaver.me/tags/matlab/">matlab</a>
    
    <a href="http://leaver.me/tags/maven/">maven</a>
    
    <a href="http://leaver.me/tags/mysql/">mysql</a>
    
    <a href="http://leaver.me/tags/nextgen-gallery/">NextGEN Gallery</a>
    
    <a href="http://leaver.me/tags/php/">php</a>
    
    <a href="http://leaver.me/tags/python/">python</a>
    
    <a href="http://leaver.me/tags/shell/">shell</a>
    
    <a href="http://leaver.me/tags/spring/">spring</a>
    
    <a href="http://leaver.me/tags/sql/">sql</a>
    
    <a href="http://leaver.me/tags/stackoverflow/">stackoverflow</a>
    
    <a href="http://leaver.me/tags/wcf/">WCF</a>
    
    <a href="http://leaver.me/tags/web/">web</a>
    
    <a href="http://leaver.me/tags/windows/">windows</a>
    
    <a href="http://leaver.me/tags/wordpress/">wordpress</a>
    
    <a href="http://leaver.me/tags/wpf/">WPF</a>
    
    <a href="http://leaver.me/tags/%E4%B8%8A%E6%B5%B7/">上海</a>
    
    <a href="http://leaver.me/tags/%E4%B8%8B%E8%BD%BD/">下载</a>
    
    <a href="http://leaver.me/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a>
    
    <a href="http://leaver.me/tags/%E4%BA%92%E8%81%94%E7%BD%91/">互联网</a>
    
    <a href="http://leaver.me/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a>
    
    <a href="http://leaver.me/tags/%E5%88%B6%E5%BA%A6/">制度</a>
    
    <a href="http://leaver.me/tags/%E5%89%8D%E7%AB%AF/">前端</a>
    
    <a href="http://leaver.me/tags/%E5%8E%9F%E5%88%9B/">原创</a>
    
    <a href="http://leaver.me/tags/%E5%A4%A7%E5%AD%A6/">大学</a>
    
    <a href="http://leaver.me/tags/%E5%AD%A6%E4%B9%A0/">学习</a>
    
    <a href="http://leaver.me/tags/%E5%AE%89%E5%85%A8/">安全</a>
    
    <a href="http://leaver.me/tags/%E5%AE%B6%E5%BA%AD/">家庭</a>
    
    <a href="http://leaver.me/tags/%E5%B7%A5%E4%BD%9C/">工作</a>
    
    <a href="http://leaver.me/tags/%E5%B7%A5%E5%85%B7/">工具</a>
    
    <a href="http://leaver.me/tags/%E5%B9%B6%E5%8F%91/">并发</a>
    
    <a href="http://leaver.me/tags/%E5%BA%8F%E5%88%97%E5%8C%96/">序列化</a>
    
    <a href="http://leaver.me/tags/%E5%BC%80%E5%8F%91/">开发</a>
    
    <a href="http://leaver.me/tags/%E5%BF%83%E7%90%86/">心理</a>
    
    <a href="http://leaver.me/tags/%E6%80%BB%E7%BB%93/">总结</a>
    
    <a href="http://leaver.me/tags/%E6%8A%80%E6%9C%AF/">技术</a>
    
    <a href="http://leaver.me/tags/%E6%8F%92%E4%BB%B6/">插件</a>
    
    <a href="http://leaver.me/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a>
    
    <a href="http://leaver.me/tags/%E6%94%B6%E8%97%8F/">收藏</a>
    
    <a href="http://leaver.me/tags/%E6%95%B0%E5%AD%A6/">数学</a>
    
    <a href="http://leaver.me/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
    
    <a href="http://leaver.me/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/">数据挖掘</a>
    
    <a href="http://leaver.me/tags/%E6%96%87%E7%AB%A0/">文章</a>
    
    <a href="http://leaver.me/tags/%E6%99%BA%E8%83%BD/">智能</a>
    
    <a href="http://leaver.me/tags/%E6%9D%82%E6%96%87/">杂文</a>
    
    <a href="http://leaver.me/tags/%E6%AD%A6%E6%B1%89/">武汉</a>
    
    <a href="http://leaver.me/tags/%E6%B1%87%E7%BC%96/">汇编</a>
    
    <a href="http://leaver.me/tags/%E7%88%B1%E6%83%85/">爱情</a>
    
    <a href="http://leaver.me/tags/%E7%90%86%E8%AE%BA/">理论</a>
    
    <a href="http://leaver.me/tags/%E7%94%9F%E4%BA%A7%E5%8A%9B/">生产力</a>
    
    <a href="http://leaver.me/tags/%E7%94%9F%E6%B4%BB/">生活</a>
    
    <a href="http://leaver.me/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/">电子书</a>
    
    <a href="http://leaver.me/tags/%E7%94%B5%E5%BD%B1/">电影</a>
    
    <a href="http://leaver.me/tags/%E7%A4%BE%E4%BC%9A/">社会</a>
    
    <a href="http://leaver.me/tags/%E7%A7%91%E6%8A%80/">科技</a>
    
    <a href="http://leaver.me/tags/%E7%AC%94%E8%AE%B0/">笔记</a>
    
    <a href="http://leaver.me/tags/%E7%AE%97%E6%B3%95/">算法</a>
    
    <a href="http://leaver.me/tags/%E7%BC%96%E7%A8%8B/">编程</a>
    
    <a href="http://leaver.me/tags/%E7%BC%96%E8%AF%91/">编译</a>
    
    <a href="http://leaver.me/tags/%E7%BF%BB%E8%AF%91/">翻译</a>
    
    <a href="http://leaver.me/tags/%E8%81%8C%E4%B8%9A/">职业</a>
    
    <a href="http://leaver.me/tags/%E8%AE%B0%E5%BD%95/">记录</a>
    
    <a href="http://leaver.me/tags/%E8%AE%BE%E8%AE%A1/">设计</a>
    
    <a href="http://leaver.me/tags/%E8%AF%BB%E4%B9%A6/">读书</a>
    
    <a href="http://leaver.me/tags/%E8%BD%AF%E4%BB%B6/">软件</a>
    
    <a href="http://leaver.me/tags/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/">软件测试</a>
    
    <a href="http://leaver.me/tags/%E8%BF%90%E7%BB%B4/">运维</a>
    
    <a href="http://leaver.me/tags/%E9%87%91%E8%9E%8D/">金融</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.cppfans.org/" title="C&#43;&#43;爱好者博客">C&#43;&#43;爱好者博客</a>
        </li>
        
        <li>
            <a target="_blank" href="http://www.kailing.pub" title="KL，每天进步一点点">KL，每天进步一点点</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="http://leaver.me/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        &copy; 2020 <a href="http://leaver.me/">bystander&#39;s blog By bystander</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/flysnow-org/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>



<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-30961201-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






</body>

</html>